export const licenseData: LicenseDates = {
    "@emotion/react@11.10.4": {
        "licenses": "MIT",
        "repository": "https://github.com/emotion-js/emotion/tree/main/packages/react",
        "licenseUrl": "https://github.com/emotion-js/emotion/tree/main/packages/react/raw/master/LICENSE",
        "parents": "webapp"
    },
    "@emotion/styled@11.10.4": {
        "licenses": "MIT",
        "repository": "https://github.com/emotion-js/emotion/tree/main/packages/styled",
        "licenseUrl": "https://github.com/emotion-js/emotion/tree/main/packages/styled/raw/master/LICENSE",
        "parents": "webapp"
    },
    "@mui/icons-material@5.10.6": {
        "licenses": "MIT",
        "repository": "https://github.com/mui/material-ui",
        "licenseUrl": "https://github.com/mui/material-ui/raw/master/LICENSE",
        "parents": "webapp"
    },
    "@mui/material@5.10.6": {
        "licenses": "MIT",
        "repository": "https://github.com/mui/material-ui",
        "licenseUrl": "https://github.com/mui/material-ui/raw/master/LICENSE",
        "parents": "webapp"
    },
    "@reduxjs/toolkit@1.8.5": {
        "licenses": "MIT",
        "repository": "https://github.com/reduxjs/redux-toolkit",
        "licenseUrl": "https://github.com/reduxjs/redux-toolkit/raw/master/LICENSE",
        "parents": "webapp"
    },
    "bootstrap@5.2.1": {
        "licenses": "MIT",
        "repository": "https://github.com/twbs/bootstrap",
        "licenseUrl": "https://github.com/twbs/bootstrap/raw/master/LICENSE",
        "parents": "webapp"
    },
    "formik@2.2.9": {
        "licenses": "Apache-2.0",
        "repository": "https://github.com/formium/formik",
        "licenseUrl": "https://github.com/formium/formik",
        "parents": "webapp"
    },
    "http-proxy-middleware@2.0.6": {
        "licenses": "MIT",
        "repository": "https://github.com/chimurai/http-proxy-middleware",
        "licenseUrl": "https://github.com/chimurai/http-proxy-middleware/raw/master/LICENSE",
        "parents": "webapp"
    },
    "js-file-download@0.4.12": {
        "licenses": "MIT",
        "repository": "https://github.com/kennethjiang/js-file-download",
        "licenseUrl": "https://github.com/kennethjiang/js-file-download/raw/master/LICENSE",
        "parents": "webapp"
    },
    "leaflet@1.9.1": {
        "licenses": "BSD-2-Clause",
        "repository": "https://github.com/Leaflet/Leaflet",
        "licenseUrl": "https://github.com/Leaflet/Leaflet/raw/master/LICENSE",
        "parents": "webapp"
    },
    "lodash@4.17.21": {
        "licenses": "MIT",
        "repository": "https://github.com/lodash/lodash",
        "licenseUrl": "https://github.com/lodash/lodash/raw/master/LICENSE",
        "parents": "webapp"
    },
    "match-sorter@6.3.1": {
        "licenses": "MIT",
        "repository": "https://github.com/kentcdodds/match-sorter",
        "licenseUrl": "https://github.com/kentcdodds/match-sorter/raw/master/LICENSE",
        "parents": "webapp"
    },
    "oidc-client@1.11.5": {
        "licenses": "Apache-2.0",
        "repository": "https://github.com/IdentityModel/oidc-client-js",
        "licenseUrl": "https://github.com/IdentityModel/oidc-client-js/raw/master/LICENSE",
        "parents": "webapp"
    },
    "point-in-polygon@1.1.0": {
        "licenses": "MIT",
        "repository": "https://github.com/substack/point-in-polygon",
        "licenseUrl": "https://github.com/substack/point-in-polygon/raw/master/LICENSE",
        "parents": "webapp"
    },
    "react-bootstrap@2.5.0": {
        "licenses": "MIT",
        "repository": "https://github.com/react-bootstrap/react-bootstrap",
        "licenseUrl": "https://github.com/react-bootstrap/react-bootstrap/raw/master/LICENSE",
        "parents": "webapp"
    },
    "react-dom@18.2.0": {
        "licenses": "MIT",
        "repository": "https://github.com/facebook/react",
        "licenseUrl": "https://github.com/facebook/react/raw/master/LICENSE",
        "parents": "webapp"
    },
    "react-draggable@4.4.5": {
        "licenses": "MIT",
        "repository": "https://github.com/react-grid-layout/react-draggable",
        "licenseUrl": "https://github.com/react-grid-layout/react-draggable/raw/master/LICENSE",
        "parents": "webapp"
    },
    "react-icons@4.4.0": {
        "licenses": "MIT",
        "repository": "https://github.com:react-icons/react-icons",
        "licenseUrl": "https://github.com:react-icons/react-icons/raw/master/LICENSE",
        "parents": "webapp"
    },
    "react-leaflet@4.1.0": {
        "licenses": "Hippocratic-2.1",
        "repository": "https://github.com/PaulLeCam/react-leaflet",
        "licenseUrl": "https://github.com/PaulLeCam/react-leaflet/raw/master/LICENSE.md",
        "parents": "webapp"
    },
    "react-redux@8.0.4": {
        "licenses": "MIT",
        "repository": "github:reduxjs/react-redux",
        "licenseUrl": "github:reduxjs/react-redux",
        "parents": "webapp"
    },
    "react-router-dom@6.4.1": {
        "licenses": "MIT",
        "repository": "https://github.com/remix-run/react-router",
        "licenseUrl": "https://github.com/remix-run/react-router/raw/master/LICENSE.md",
        "parents": "webapp"
    },
    "react-router@6.4.1": {
        "licenses": "MIT",
        "repository": "https://github.com/remix-run/react-router",
        "licenseUrl": "https://github.com/remix-run/react-router/raw/master/LICENSE.md",
        "parents": "webapp"
    },
    "react-window@1.8.7": {
        "licenses": "MIT",
        "repository": "https://github.com/bvaughn/react-window",
        "licenseUrl": "https://github.com/bvaughn/react-window/raw/master/LICENSE.md",
        "parents": "webapp"
    },
    "react@18.2.0": {
        "licenses": "MIT",
        "repository": "https://github.com/facebook/react",
        "licenseUrl": "https://github.com/facebook/react/raw/master/LICENSE",
        "parents": "webapp"
    },
    "rimraf@3.0.2": {
        "licenses": "ISC",
        "repository": "https://github.com/isaacs/rimraf",
        "licenseUrl": "https://github.com/isaacs/rimraf/raw/master/LICENSE",
        "parents": "webapp"
    },
    "web-vitals@3.0.2": {
        "licenses": "Apache-2.0",
        "repository": "https://github.com/GoogleChrome/web-vitals",
        "licenseUrl": "https://github.com/GoogleChrome/web-vitals/raw/master/LICENSE",
        "parents": "webapp"
    },
    "workbox-core@6.5.4": {
        "licenses": "MIT",
        "repository": "https://github.com/googlechrome/workbox",
        "licenseUrl": "https://github.com/googlechrome/workbox/raw/master/LICENSE",
        "parents": "webapp"
    },
    "workbox-expiration@6.5.4": {
        "licenses": "MIT",
        "repository": "https://github.com/googlechrome/workbox",
        "licenseUrl": "https://github.com/googlechrome/workbox/raw/master/LICENSE",
        "parents": "webapp"
    },
    "workbox-precaching@6.5.4": {
        "licenses": "MIT",
        "repository": "https://github.com/googlechrome/workbox",
        "licenseUrl": "https://github.com/googlechrome/workbox/raw/master/LICENSE",
        "parents": "webapp"
    },
    "workbox-routing@6.5.4": {
        "licenses": "MIT",
        "repository": "https://github.com/googlechrome/workbox",
        "licenseUrl": "https://github.com/googlechrome/workbox/raw/master/LICENSE",
        "parents": "webapp"
    },
    "workbox-strategies@6.5.4": {
        "licenses": "MIT",
        "repository": "https://github.com/googlechrome/workbox",
        "licenseUrl": "https://github.com/googlechrome/workbox/raw/master/LICENSE",
        "parents": "webapp"
    },
    "yup@0.32.11": {
        "licenses": "MIT",
        "repository": "https://github.com/jquense/yup",
        "licenseUrl": "https://github.com/jquense/yup/raw/master/LICENSE.md",
        "parents": "webapp"
    }
}

export type LicenseDates = {
    [key: string]: LicenseData
}

export type LicenseData = {
    licenses: string,
    repository: string,
    licenseUrl: string,
    parents: string
}

export type License = {
    key: string,
    name: string,
    image?: string,
    userUrl?: string,
    username?: string | null,
    licenses: string,
    version: string,
    licenseUrl: string,
    repository: string
}

function extractNameFromGithubUrl(url?: string) {
    if (!url) {
        return null;
    }

    const reg =
        /((https?:\/\/)?(www\.)?github\.com\/)?(@|#!\/)?([A-Za-z0-9_]{1,15})(\/([-a-z]{1,20}))?/i;
    const components = reg.exec(url);

    if (components && components.length > 5) {
        return components[5];
    }
    return null;
}

function sortDataByKey(data: {[keyof: string]: any}, key: string) {
    data.sort(function (a : {[keyof: string]: any}, b: {[keyof: string]: any}) {
        return a[key] > b[key] ? 1 : b[key] > a[key] ? -1 : 0;
    });
    return data;
}

function capitalizeFirstLetter(string: string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}


export const getLicenses: () => License[] = () => {
    let licensesParsed = Object.keys(licenseData).map((key) => {
        let { licenses, ...license } = licenseData[key];
        let [name, version] = key.split('@').slice(-2);

        let username =
            extractNameFromGithubUrl(license.repository) ||
            extractNameFromGithubUrl(license.licenseUrl);

        let userUrl;
        let image;
        if (username) {
            username = capitalizeFirstLetter(username);
            image = `http://github.com/${username}.png`;
            userUrl = `http://github.com/${username}`;
        }

        return {
            key,
            name,
            image,
            userUrl,
            username,
            licenses: licenses.slice(0, 405),
            version,
            ...license,
        };
    });

    sortDataByKey(licensesParsed, 'username');
    
    return licensesParsed
}